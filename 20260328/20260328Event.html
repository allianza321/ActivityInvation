<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3/28 ä¿æˆ¶è¬›åº§è³‡è¨Šè½‰ç™¼</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f4f7f6; }
        .card { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; max-width: 85%; position: relative; }
        h2 { color: #003777; margin-bottom: 0.5rem; font-size: 1.4rem; }
        .event-title { color: #E67E22; font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem; }
        .info { color: #666; font-size: 0.95rem; margin-bottom: 1.5rem; }
        .btn-send { padding: 16px 40px; font-size: 1.1rem; background: linear-gradient(135deg, #0056b3 0%, #003777 100%); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0,55,119,0.3); transition: 0.3s; }
        .btn-send:hover { transform: scale(1.02); }
        .pc-tip { color: #7f8c8d; font-size: 0.85rem; margin-top: 1.2rem; line-height: 1.6; display: none; }
        .mobile-tip { color: #ff0000; font-size: 0.85rem; margin-top: 1.2rem; font-weight: bold; display: none; }
        .version-tag { position: absolute; bottom: 10px; left: 15px; font-size: 10px; color: #e0e0e0; }
    </style>
</head>
<body>
    <div class="card">
        <h2>å®‰è¯äººå£½ä¿æˆ¶è¬›åº§</h2>
        <div class="event-title">2026å¹´åäºŒæ˜Ÿåº§é–‹é‹è§£æ</div>
        <div class="info">å®åœ‹é€šè¨Šè™• 2026/3/28(å…­)</div>
        <button class="btn-send" onclick="sendActivityFlex()">é»æ­¤é¸æ“‡å¥½å‹ç™¼é€é‚€è«‹</button>
        <div id="pcTip" class="pc-tip">ğŸ’¡ é›»è…¦ç‰ˆæç¤ºï¼šæ‚¨å¯ä»¥ç›´æ¥ç™»å…¥ç™¼é€ï¼Œ<br>æˆ–ä½¿ç”¨æ‰‹æ©Ÿ LINE é–‹å•Ÿæ­¤é€£çµä»¥ç²å¾—æ›´é †æš¢çš„åˆ†äº«é«”é©—ã€‚</div>
        <div id="mobileTip" class="mobile-tip">â€» è«‹å‹™å¿…åœ¨ LINE ç¨‹å¼å…§é–‹å•Ÿæ­¤é é¢</div>
        <div class="version-tag">Ver. 19</div>
    </div>

    <script>
        const liffId = "2009178037-6FFsbvG7";

        function downloadIcs() {
            const icsData = "BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\n" +
                "SUMMARY:ã€å®‰è¯äººå£½ã€‘2026å¹´åäºŒæ˜Ÿåº§é–‹é‹è§£æ\n" +
                "DTSTART:20260328T010000Z\n" +
                "DTEND:20260328T040000Z\n" +
                "LOCATION:å°åŒ—å¸‚ä¿¡ç¾©å€åŸºéš†è·¯äºŒæ®µ51è™Ÿ10æ¨“ä¹‹äºŒ(å®åœ‹é€šè¨Šè™•)\n" +
                "DESCRIPTION:æ­¡è¿åƒåŠ å®åœ‹é€šè¨Šè™•èˆ‰è¾¦çš„æ˜Ÿåº§é–‹é‹è¬›åº§ï¼å»ºè­°æå‰ä¸€å¤©è¨­å®šæé†’ã€‚\n" +
                "BEGIN:VALARM\nTRIGGER:-P1D\nACTION:DISPLAY\nDESCRIPTION:Reminder\nEND:VALARM\n" +
                "END:VEVENT\nEND:VCALENDAR";
            const blob = new Blob([icsData], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.setAttribute('download', 'event.ics');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function initLiff() {
            const params = new URLSearchParams(window.location.search);
            if (params.get('action') === 'cal') {
                downloadIcs();
                setTimeout(() => { window.location.href = window.location.origin + window.location.pathname; }, 1000);
                return;
            }
            try {
                await liff.init({ liffId: liffId });
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                if (liff.isInClient()) {
                    if (!liff.isLoggedIn()) { liff.login(); }
                } else {
                    if (isMobile) {
                        document.getElementById('mobileTip').style.display = 'block';
                        window.location.href = `line://app/${liffId}`;
                    } else {
                        document.getElementById('pcTip').style.display = 'block';
                        if (!liff.isLoggedIn()) { liff.login(); }
                    }
                }
            } catch (err) { console.error("LIFF åˆå§‹åŒ–å¤±æ•—", err); }
        }

        async function sendActivityFlex() {
            const urlParams = new URLSearchParams(window.location.search);
            const referrer = urlParams.get('from') || 'General';
            const calendarAction = `https://liff.line.me/${liffId}?action=cal`;
            const mapUrl = "https://www.google.com/maps/search/?api=1&query=" + encodeURIComponent("å®‰è¯äººå£½ å®åœ‹é€šè¨Šè™•");

            if (liff.isApiAvailable('shareTargetPicker')) {
                try {
                    await liff.shareTargetPicker([{
                        "type": "flex",
                        "altText": "æ‚¨æ”¶åˆ°ä¸€ä»½ä¾†è‡ª å®åœ‹é€šè¨Šè™• çš„æ´»å‹•ç†±æƒ…é‚€ç´„ï¼",
                        "contents": {
                            "type": "bubble",
                            "hero": {
                                "type": "image",
                                "url": "https://github.com/allianza321/ActivityInvation/blob/allianza321-Activity/20260328/20260328_TuYuPing_header.JPG?raw=true",
                                "size": "full", "aspectRatio": "20:13", "aspectMode": "cover",
                                "action": { "type": "uri", "uri": "https://github.com/allianza321/ActivityInvation/blob/allianza321-Activity/20260328/20260328%E4%BF%9D%E6%88%B6%E8%AC%9B%E5%BA%A7%E6%B4%BB%E5%8B%95.JPG?raw=true" }
                            },
                            "body": {
                                "type": "box", "layout": "vertical", "contents": [
                                    { "type": "text", "text": "å®‰è¯äººå£½ä¿æˆ¶è¬›åº§", "weight": "bold", "size": "xl" },
                                    { "type": "text", "text": "2026å¹´åäºŒæ˜Ÿåº§é–‹é‹è§£æ", "size": "md", "color": "#E67E22", "weight": "bold", "margin": "sm" },
                                    { "type": "box", "layout": "vertical", "margin": "xl", "spacing": "sm", "contents": [
                                        { 
                                            "type": "box", "layout": "baseline", "spacing": "sm",
                                            "action": { "type": "uri", "label": "åŠ å…¥è¡Œäº‹æ›†", "uri": calendarAction },
                                            "contents": [
                                                { "type": "text", "text": "æ™‚é–“", "color": "#aaaaaa", "size": "sm", "flex": 1 },
                                                { "type": "text", "text": "2026/3/28(å…­) 09:00 - 12:00", "wrap": true, "color": "#0056b3", "size": "sm", "flex": 5, "decoration": "underline" }
                                            ]
                                        },
                                        { "type": "spacer", "size": "md" },
                                        { "type": "separator", "margin": "md" },
                                        { "type": "spacer", "size": "md" },
                                        { 
                                            "type": "box", "layout": "baseline", "spacing": "sm",
                                            "action": { "type": "uri", "label": "é–‹å•Ÿåœ°åœ–", "uri": mapUrl },
                                            "contents": [
                                                { "type": "text", "text": "åœ°é»", "color": "#aaaaaa", "size": "sm", "flex": 1 },
                                                { "type": "text", "text": "å°åŒ—å¸‚ä¿¡ç¾©å€åŸºéš†è·¯äºŒæ®µ51è™Ÿ10æ¨“ä¹‹äºŒ(å®åœ‹é€šè¨Šè™•)", "wrap": true, "color": "#0056b3", "size": "sm", "flex": 5, "decoration": "underline" }
                                            ]
                                        }
                                    ]}
                                ]
                            },
                            "footer": {
                                "type": "box", "layout": "vertical", "spacing": "sm", "contents": [
                                    { "type": "button", "style": "link", "height": "sm", "action": { "type": "uri", "label": "å³åˆ»å ±å", "uri": "https://docs.google.com/forms/d/e/1FAIpQLSfwNIB1dN8B1A-BIqAjxtzlIO4fUP_LAs-6_29t5TPI5Fpndg/viewform" } },
                                    { "type": "button", "style": "link", "height": "sm", "action": { "type": "uri", "label": "åˆ†äº«å¥½å‹", "uri": `https://liff.line.me/${liffId}?from=${referrer}` } }
                                ]
                            }
                        }
                    }]);
                    liff.closeWindow();
                } catch (error) { console.error(error); }
            }
        }
        initLiff();
    </script>
</body>
</html>
